---
title: "IMtool2"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    social: menu
    source_code: embed
---

```{r setup, include=FALSE}
library(ggplot2)
library(plotly)
library(plyr)
library(flexdashboard)

```

Search
=======================================================================

Row
-----------------------------------------------------------------------

### stat_density Example

```{r}

```

### Add Conditional Density Curves to Plot

```{r}

```

Row
-----------------------------------------------------------------------

### geom_density and facet_wrap Together

```{r}

```

### Density and Scatterplot Overlay Using geom_density

```{r}

```

Patents
=======================================================================

```{r include=FALSE}
library(patentsview)
library(dplyr)
library(highcharter)
library(DT)
library(knitr)
library(visNetwork)
library(magrittr)
library(stringr)

### Query Function
query <- with_qfuns(
      or(
            text_phrase(patent_abstract = "autonomous vehicles"),
            text_phrase(patent_title = "autonomous vehicles")
      )
)

# Create a list of the fields we'll need for the analysis:
fields <- c("patent_number", "assignee_organization",
            "patent_num_cited_by_us_patents", "app_date", "patent_date",
            "assignee_total_num_patents")

# Send an HTTP request to the PatentsView API to get data:
pv_out <- search_pv(query = query, fields = fields, all_pages = TRUE)
```


Row
-----------------------------------------------------------------------

### Top Assignes


### Citation rate


Row
-----------------------------------------------------------------------

### Citation Network

### Citation Network 2

Scientometric
=======================================================================

```{r include=FALSE}
library(bibliometrix)
library(treemap)
library(tm)
library(pander)
library(knitr)

Dtisi <- readFiles("~/MEGA/IMTOOL2/IMtool2/data/savedrecs.bib")
database <- convert2df(Dtisi, dbsource = "isi", format = "bibtex")
dfbiblio <- biblioAnalysis(database, sep = ";")
df.summary <- summary(object = dfbiblio, k = 10, pause = FALSE)
```


Row
-----------------------------------------------------------------------

### Top Articles 

```{r}
knitr::kable(df.summary$MostCitedPapers)
```

### Most Productive Countries

```{r}
knitr::kable(df.summary$TCperCountries, align = 'c')
```

Row
-----------------------------------------------------------------------

### Most Relevant Sources

```{r}
knitr::kable(df.summary$MostRelSources)
```

### Most Related Keyword

```{r}
knitr::kable(df.summary$MostRelKeywords)
```

Trends
=======================================================================

```{r include=FALSE}
library(gtrendsR)
library(forecast)
library(tseries)

keyword = c("autonomous vehicles", "self driving cars")

res = gtrends(keyword, geo = "", time = "all", gprop = "web", category = 0, hl = "en-US")

keyword_pt = "carro autonomo"

res_pt = gtrends(keyword_pt, geo = "BR", time = "all", gprop = "web", category = 0)

gt.fc.en <- res$interest_over_time
fc.en <- forecast(res$hits)

xt_en <- window(gt.fc.en[,2],end=218)
xf_en <- window(gt.fc.en[,2],start=219)

gt.fc.br <- res_pt$interest_over_time
fc.br <- forecast(res_pt$hits)

xt_pt <- window(gt.fc.br[,2],end=100)
xt_pt <- window(gt.fc.br[,2],start = 101)
```


Row
-----------------------------------------------------------------------

### Google Trends World

```{r}
plot(res)
```

### Forecast analysis - EN

```{r}
rwd_en <- rwf(xt_en,drift=T,h=25)
plot(rwd_en,main="Random Walk with Drift Method",ylab="Level",xlab="Tseries")
lines(gt.fc.en[,2])
```

Row
-----------------------------------------------------------------------

### Google Trends - Brasil

```{r}
plot(res_pt)
```

### Forecast Analysis - Brazil

```{r}
rwd_br <- rwf(xt_pt,drift=T,h=66)
plot(rwd_br,main="Random Walk with Drift Method",ylab="Level",xlab="Months")
lines(gt.fc.br[,2])
```

News
=======================================================================

```{r}
library(tm.plugin.webmining)
yahoonews <- WebCorpus(YahooNewsSource("Autonomous vehicles"))
googlenews <- WebCorpus(GoogleNewsSource("Autonomous vehicles"))
```


Row
-----------------------------------------------------------------------

### News Trends

```{r}

```

### Add Conditional Density Curves to Plot

```{r}

```

Row
-----------------------------------------------------------------------

### geom_density and facet_wrap Together

```{r}

```

### Density and Scatterplot Overlay Using geom_density

```{r}

```

OECD
=======================================================================

Row
-----------------------------------------------------------------------

### stat_density Example

```{r}

```

### Add Conditional Density Curves to Plot

```{r}

```

Row
-----------------------------------------------------------------------

### geom_density and facet_wrap Together

```{r}

```

### Density and Scatterplot Overlay Using geom_density

```{r}

```

EUROSTAT
=======================================================================

```{r include=FALSE}
library(eurostat)
library(rvest)
# Check Id
id <- search_eurostat("Passenger cars, by alternative motor energy and by power of vehicles",type = "dataset")$code[1]

# Download Dataset
dat <-get_eurostat(id, time_format = "num", type = "label")
dat <- data.frame(dat)


# Subset by type of energy
elec <- subset(dat, prod_nrg == "Electrical Energy", select = c(geo, time, values))
gas <- subset(dat, prod_nrg == "Natural Gas", select = c(geo, time, values))
lpg <- subset(dat, prod_nrg == "LPG", select = c(geo, time, values))
other <- subset(dat, prod_nrg == "Other products", select = c(geo, time, values))
total <- subset(dat, prod_nrg == "Total", select = c(geo, time, values)) 
      
# Total analysis
el.date <- aggregate(values ~ time, elec, sum)
gas.date <- aggregate(values ~ time, gas, sum)
lpg.date <- aggregate(values ~ time, lpg, sum)
other.date <- aggregate(values ~ time, other, sum)
total.date <- aggregate(values ~ time, total, sum)
```


Row
-----------------------------------------------------------------------

### Sector Investment

```{r}
# Plot by Sector/Years
p <- plot(el.date, type='o', 
          col="red", 
          ylab="Amount of Eur(millions)", 
          xlab="Years",
          ylim = c(0, 10000))

points(values ~ time, data=gas.date, type='b', col="green")
points(values ~ time, data=lpg.date, type='l',lty=2, col="blue")
points(values ~ time, data=other.date, type='l', col="orange")
title(main="Investiment in Automotive Sector in UE", col.main="black", font.main=4)
legend("topleft", 
       c("Electric", "Gas", "Lpg", "Other"), 
       lty = c(1,1,1,1), 
       col = c("red", "green", "blue", "orange"))
```

### Countries Analisys

```{r}
# Dendogram
total.geo <- aggregate(values ~ geo, total, sum)
dd <- dist(scale(total.geo$values), method = "euclidean")
name <- as.factor(total.geo$geo)
hc <- hclust(dd, method = "ward.D2")
plot(hc)
```

Row
-----------------------------------------------------------------------

### geom_density and facet_wrap Together

```{r}

```

### Density and Scatterplot Overlay Using geom_density

```{r}

```

Trends Series (BETS)
=======================================================================

Row
-----------------------------------------------------------------------

### stat_density Example

```{r}

```

### Add Conditional Density Curves to Plot

```{r}

```

Row
-----------------------------------------------------------------------

### geom_density and facet_wrap Together

```{r}

```

### Density and Scatterplot Overlay Using geom_density

```{r}

```

Twitter
=======================================================================

Row
-----------------------------------------------------------------------

### stat_density Example

```{r}

```

### Add Conditional Density Curves to Plot

```{r}

```

Row
-----------------------------------------------------------------------

### geom_density and facet_wrap Together

```{r}

```

### Density and Scatterplot Overlay Using geom_density

```{r}

```

Survey
=======================================================================

```{r}
### General Analysis for UE28
library(dplyr)
cat = c('un', 'fa', 'co')
ue28tr = c(16840, 3814, 5893)
ue28go = c(14568, 4515, 7236)
m_tr = ue28tr / sum(ue28tr)
m_go = ue28go / sum(ue28go)

### Analysis include all 28 Countries
dfsurvey <- read.csv("~/MEGA/IMTOOL2/IMtool2/data/travel.csv")

### Create means by 3 variables by row
dfsurvey$total <- apply(dfsurvey[ , 2:4], 1, sum)
dfsurvey$un_mean <- dfsurvey$uncomfortable / dfsurvey$total
dfsurvey$fa_mean <- dfsurvey$fairly / dfsurvey$total
dfsurvey$co_mean <- dfsurvey$comfortable / dfsurvey$total
```


Row
-----------------------------------------------------------------------

### Sector Investment

```{r}

```

### Countries analysis 

```{r}

```

Row
-----------------------------------------------------------------------

### geom_density and facet_wrap Together

```{r}

```

### Density and Scatterplot Overlay Using geom_density

```{r}

```

